{"remainingRequest":"/Users/yuanbo/Desktop/与燕/222/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js??vue-loader-options!/Users/yuanbo/Desktop/与燕/222/src/views/settings/components/EditTelephone.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuanbo/Desktop/与燕/222/src/views/settings/components/EditTelephone.vue","mtime":1560734686049},{"path":"/Users/yuanbo/Desktop/与燕/222/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuanbo/Desktop/与燕/222/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuanbo/Desktop/与燕/222/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuanbo/Desktop/与燕/222/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport AccountValidateVue from './AccountValidate.vue';\nexport default {\n    components: {\n\n      \"account-validate\": AccountValidateVue\n    },\n    data() {\n        return {\n            editDialogShow: false,\n            isValidateAccount: false,\n            awardBtnRun: false,\n            timer:null,\n            codeTxt:\"获取验证码\",\n            count: '',  \n            neweditform: {\n                telephone: '',\n                code: ''\n            },          \n            editform: {\n                telephone: JSON.parse(localStorage.getItem(\"user\")).tel,\n                code: ''\n            },\n             editRules:{\n              telephone: [\n                  { required: true, message: '请输入手机号', trigger: 'blur' },\n              ],\n              code: [\n                  { required: true, message: '请输入验证码', trigger: 'change' },\n              ], \n                newPassword: [{ required: true, message: '请输入新密码', trigger: 'blur' }],\n                resPassword: [{ required: true, message: '请再次输入新密码', trigger: 'blur' }]\n            },\n             neweditRules:{\n              telephone: [\n                  { required: true, message: '请输入手机号', trigger: 'blur' },\n              ],\n              code: [\n                  { required: true, message: '请输入验证码', trigger: 'change' },\n              ]\n            }              \n\n            \n        }\n    },\n    methods: {\n        /*\n        **获取验证码事件\n        */\n        async handleAwardCode(){\n                    let _this = this\n                    _this.awardBtnRun = true\n                    const Time_COUNT = 60;\n                    let resData = await _this.http.post(_this.isValidateAccount?\"/platformUser/getRePasswordVerify\":\"/platformUser/getRePhoneVerify\" ,{tel: _this.isValidateAccount?_this.editform.telephone:_this.neweditform.telephone})\n                    if(resData)\n                    {\n                      _this.$message.success(resData.msg) \n                    }            \n                    if(!_this.timer)\n                    {\n                        _this.count = Time_COUNT;\n                        _this.timer = setInterval(()=>{\n                            if(_this.count>0 && _this.count <= Time_COUNT)\n                            {\n                                _this.count --;\n                            }\n                            else\n                            {\n                                _this.awardBtnRun = false\n                                clearInterval(this.timer)\n                                _this.timer = null\n                                _this.codeTxt = \"重新获取\";\n                            }\n                        }, 1000)\n                    }                  \n        },\n        /*\n        **点击下一步\n        */        \n        handleNextTep(){\n          this.$refs.editform.validateField(['code'], async (valid) =>{\n            if(!valid){\n              let resData = await this.http.get('/platformUser/checkVerify', {code: this.editform.code})\n              if(resData.data.token){\n                localStorage.setItem('AVtoken', resData.data.token)\n                this.isValidateAccount = false\n                this.$refs.editform.clearValidate()\n                this.$refs.neweditform.clearValidate()\n                this.awardBtnRun = false\n              }\n            }\n          })\n        },\n        /*\n        **确认修改密码\n        */   \n        async handleConfirmEdit(){\n          let data = {\n            tel: this.neweditform.telephone,\n            code: this.neweditform.code,\n            __token__: localStorage.getItem(\"AVtoken\")\n          }\n          let resData = await this.http.post('/platformUser/resetPhone', data)\n          if(resData.code === 200)\n          {\n            this.$message.success(resData.msg)\n          }\n        }        \n    },\n    created() {\n        this.isValidateAccount = true\n    },\n}\n",{"version":3,"sources":["EditTelephone.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EditTelephone.vue","sourceRoot":"src/views/settings/components","sourcesContent":["<template>\n    <div>\n        <div class=\"manageOption\">\n            <span class=\"manage-title\">您当前绑定的手机号码为：<span class=\"sys-text\">187 **** 7864</span></span>\n            <el-button class=\"sys-Btn\"   type=\"primary\" @click=\"editDialogShow = true\">修改</el-button>\n        </div> \n        \n      <el-dialog class=\"dialog\"\n           title=\"修改手机号\"\n           :visible.sync=\"editDialogShow\"\n           width=\"35%\"\n           >\n           <template v-if=\"isValidateAccount\">\n             <div class=\"top-intro-area\">\n                 <span class=\"top-intro-text\">温馨提示：为了保证您的账户安全，修改密码前请先进行安全验证。</span>\n             </div>\n             <el-form :model=\"editform\" :rules=\"editRules\" ref=\"editform\" label-width=\"8rem\" size=\"medium\" label-position=\"right\" class=\"bindPhoneForm\">\n               <el-form-item label=\"手机号：\" prop=\"telephone\">\n                 <el-input disabled v-model=\"editform.telephone\"></el-input>\n               </el-form-item>\n               <el-form-item label=\"验证码：\" id=\"input-code\" prop=\"code\">\n                 <el-input v-model=\"editform.code\" ></el-input>\n                     <el-button v-if=\"!awardBtnRun\" class=\"sys-Btn code-btn\" @click=\"handleAwardCode\"   type=\"primary\" >验证码</el-button>\n                     <el-button v-else class=\"sys-Btn code-btn awardCode-Btn-run\"   type=\"primary\" >重新获取({{count}})s</el-button>\n               </el-form-item> \n             </el-form>               \n           </template>\n           <template v-else>\n             <div class=\"top-intro-area\">\n                 <span class=\"top-intro-text\">温馨提示：为了保证新的手机号为您自己的手机号码，更改新的手机需要安全验证。</span>                                  \n             </div> \n             <el-form :model=\"neweditform\" :rules=\"neweditRules\" ref=\"neweditform\" label-width=\"8rem\" size=\"medium\" label-position=\"right\" class=\"bindPhoneForm\">\n               <el-form-item label=\"手机号：\" prop=\"telephone\">\n                 <el-input v-model=\"neweditform.telephone\"></el-input>\n               </el-form-item>\n               <el-form-item label=\"验证码：\" id=\"input-code\" prop=\"code\">\n                 <el-input v-model=\"neweditform.code\" ></el-input>\n                     <el-button v-if=\"!awardBtnRun\" class=\"sys-Btn code-btn\" @click=\"handleAwardCode\"   type=\"primary\" >验证码</el-button>\n                     <el-button v-else class=\"sys-Btn code-btn awardCode-Btn-run\"   type=\"primary\" >重新获取({{count}})s</el-button>\n               </el-form-item> \n             </el-form>              \n           </template>\n\n            <span slot=\"footer\" class=\"dialog-footer\">\n             <el-button v-if=\"!isValidateAccount\" class=\"sys-Btn\" type=\"primary\" @click=\"handleConfirmEdit\">确 定</el-button> \n             <el-button v-else class=\"sys-Btn\" type=\"primary\" @click=\"handleNextTep\">下一步</el-button>               \n             <el-button @click=\"editDialogShow = false\">取 消</el-button>\n            </span>    \n        </el-dialog>                 \n    </div>\n</template>\n<script>\nimport AccountValidateVue from './AccountValidate.vue';\nexport default {\n    components: {\n\n      \"account-validate\": AccountValidateVue\n    },\n    data() {\n        return {\n            editDialogShow: false,\n            isValidateAccount: false,\n            awardBtnRun: false,\n            timer:null,\n            codeTxt:\"获取验证码\",\n            count: '',  \n            neweditform: {\n                telephone: '',\n                code: ''\n            },          \n            editform: {\n                telephone: JSON.parse(localStorage.getItem(\"user\")).tel,\n                code: ''\n            },\n             editRules:{\n              telephone: [\n                  { required: true, message: '请输入手机号', trigger: 'blur' },\n              ],\n              code: [\n                  { required: true, message: '请输入验证码', trigger: 'change' },\n              ], \n                newPassword: [{ required: true, message: '请输入新密码', trigger: 'blur' }],\n                resPassword: [{ required: true, message: '请再次输入新密码', trigger: 'blur' }]\n            },\n             neweditRules:{\n              telephone: [\n                  { required: true, message: '请输入手机号', trigger: 'blur' },\n              ],\n              code: [\n                  { required: true, message: '请输入验证码', trigger: 'change' },\n              ]\n            }              \n\n            \n        }\n    },\n    methods: {\n        /*\n        **获取验证码事件\n        */\n        async handleAwardCode(){\n                    let _this = this\n                    _this.awardBtnRun = true\n                    const Time_COUNT = 60;\n                    let resData = await _this.http.post(_this.isValidateAccount?\"/platformUser/getRePasswordVerify\":\"/platformUser/getRePhoneVerify\" ,{tel: _this.isValidateAccount?_this.editform.telephone:_this.neweditform.telephone})\n                    if(resData)\n                    {\n                      _this.$message.success(resData.msg) \n                    }            \n                    if(!_this.timer)\n                    {\n                        _this.count = Time_COUNT;\n                        _this.timer = setInterval(()=>{\n                            if(_this.count>0 && _this.count <= Time_COUNT)\n                            {\n                                _this.count --;\n                            }\n                            else\n                            {\n                                _this.awardBtnRun = false\n                                clearInterval(this.timer)\n                                _this.timer = null\n                                _this.codeTxt = \"重新获取\";\n                            }\n                        }, 1000)\n                    }                  \n        },\n        /*\n        **点击下一步\n        */        \n        handleNextTep(){\n          this.$refs.editform.validateField(['code'], async (valid) =>{\n            if(!valid){\n              let resData = await this.http.get('/platformUser/checkVerify', {code: this.editform.code})\n              if(resData.data.token){\n                localStorage.setItem('AVtoken', resData.data.token)\n                this.isValidateAccount = false\n                this.$refs.editform.clearValidate()\n                this.$refs.neweditform.clearValidate()\n                this.awardBtnRun = false\n              }\n            }\n          })\n        },\n        /*\n        **确认修改密码\n        */   \n        async handleConfirmEdit(){\n          let data = {\n            tel: this.neweditform.telephone,\n            code: this.neweditform.code,\n            __token__: localStorage.getItem(\"AVtoken\")\n          }\n          let resData = await this.http.post('/platformUser/resetPhone', data)\n          if(resData.code === 200)\n          {\n            this.$message.success(resData.msg)\n          }\n        }        \n    },\n    created() {\n        this.isValidateAccount = true\n    },\n}\n</script>\n<style lang=\"less\" scoped>\n#input-code{\n  margin-bottom: 1.6667rem;\n  .el-input{\n  width: 73%;\n  }\n  .code-btn{\n    margin-left: 5%;\n  }\n\n}   \n</style>\n"]}]}